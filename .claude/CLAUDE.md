# Project Overview

<!-- 
One liner on what the project is-cover the technology, framework, or any other relevant context
-->

## Project Context

**Tech Stack:**
- PostgreSQL [version]
- Python [version]
- [Other key technologies]

**Primary Use Case:**
[Describe the main purpose - e.g., "Multi-tenant SaaS application with PostgreSQL backend" or "Data pipeline for analytics warehouse"]

## Critical Rules (Always Apply First)

 - **NO AI MENTIONS** in comments, documentation, or code - no "AI-assisted", "Claude", "generated by", or similar text
 - **Check for local `.claude/CLAUDE.md`** - Project rules append, reinforce, or replace conflicting rules from this file
 - **Security first** - Never commit secrets, API keys, or credentials
 - **Read before editing** - Always use Read tool before Edit/Write
 - **No proactive file creation** - Only create files when explicitly requested
 - **No backup files** - Git handles version control
 - **NEVER give time estimates** - No "2-3 hours", "a few days", "~1 week", etc. Just describe steps, not durations.
 - **KISS principle** - Default to SIMPLEST solution. No features "just in case". MVP first.
 - **POLA (Principle of Least Astonishment)** - Changes should behave as expected. Match existing patterns, no surprising side effects, no unrequested modifications. See `~/.claude/skills/least-astonishment/`.
 - **No "pre-existing" errors** - ALL errors and warnings must be fixed when found. Never dismiss issues as "pre-existing" or "not caused by my changes." If validation, tests, or any check reveals a problem, fix it immediately regardless of when it was introduced. Warnings are errors too - treat them with the same urgency.
 - **Check state before proposing changes** - Before suggesting any action (deletion, modification, creation), verify current state first. Use status commands, read config files, check with dry-run flags. Don't propose solutions to problems that may not exist or may already be solved.
 - **No validation phrases when you screw up** - Never say "You're absolutely right", "Great question!", "That's a great point", etc. These phrases signal you made a significant error and are deflecting with flattery. When wrong, state what was wrong and how to fix it. No preamble.
 - **Ask, don't assume** - Never guess or fill in blanks. Ask clarifying questions.
 - **One question at a time** - Use AskUserQuestion tool with multiSelect: true when possible.
 - **ALWAYS use AskUserQuestion tool** - when you need to ask the user questions.

## Communication & Code Style

### Communication
- Be concise and direct
- Avoid excessive emojis

### Code Quality
- Prefer explicit over implicit
- Write clear comments for complex logic
- Follow existing project code style

## File Operations

### Basic Rules
- **Read before Edit/Write** - Verify content first
- **Prefer Edit over Write** - For existing files
- Check file existence before creating

## Tool Usage & Todo Management

### Tool Preferences
- Specialized tools (Read/Edit/Grep/Glob) > bash commands
- Parallel execution for independent operations
- Task tool for complex multi-step work
- Complete ALL steps of clear-scope tasks without asking between steps

### TodoWrite Usage
**Use for:** 3+ step tasks, complex planning, user-requested lists
**Skip for:** Single/trivial tasks, informational requests
**Rules:** Mark in_progress before starting, mark [x] IMMEDIATELY after each completion, one in_progress max

## Common Pitfalls to Avoid
- **Time estimates** → ❌ "~2 hours", "Phase 1: 1 day" ✅ "Steps: 1. X, 2. Y, 3. Z"
- Committing without explicit request
- Proactive file creation
- Assuming project structure without checking
- Manual .venv activation in uv projects → use `uv run`
- Unnecessary command flags → `-m` only for modules, not scripts
- Complex heredocs → use Task tool instead
- Non-idempotent scripts → ALL setup/install scripts MUST be safely re-runnable
- State tracking files → Detect state from system directly

---

## Auto-Activating Skills

<!-- 
Remove skills that are not relevant to the project
-->

**Skills load automatically when relevant** - conserving context for unrelated work.

### Security & Protection
- **damage-control**: When user mentions damage control, security hooks, protected paths, blocked commands, install security, or modify protection settings

### Development Process
- **brainstorming**: Before creative work - creating features, building components, adding functionality, or modifying behavior
- **writing-plans**: When you have a spec or requirements for a multi-step task, before touching code
- **executing-plans**: When you have a written implementation plan to execute in a separate session with review checkpoints
- **systematic-debugging**: When encountering any bug, test failure, or unexpected behavior, before proposing fixes
- **verification-before-completion**: When about to claim work is complete, fixed, or passing, before committing or creating PRs

### Code Review
- **requesting-code-review**: When completing tasks, implementing major features, or before merging to verify work meets requirements
- **receiving-code-review**: When receiving code review feedback, before implementing suggestions, especially if feedback seems unclear or technically questionable

### Language & Framework
- **python-workflow**: Triggers: .py, pyproject.toml, uv, pip, pytest, Python
- **api-script**: When creating Python scripts that fetch data from REST APIs, adding new API integrations, or when user asks for help with weather, IoT, or external services
- **nix**: Triggers: .nix, flake.nix, default.nix, nixpkgs, derivation, buildRustPackage, buildPythonPackage, NixOS modules

### Database & Data Engineering
- **data_engineering**: When working with Snowflake (query optimization, warehouse configuration) or developing DBT models (data quality testing and validation)
- **pg_design**: When designing database schemas, implementing table partitioning, setting up HA/DR with replication, building multi-tenant SaaS applications, architecting scalable PostgreSQL systems, planning failover strategies, or designing data models
- **pg_optimization**: When tuning PostgreSQL configuration parameters, analyzing slow queries, optimizing query performance, working with cloud-managed PostgreSQL (RDS/Cloud SQL/Azure), monitoring database health, detecting bloat or missing indexes, troubleshooting performance issues, designing indexes, or managing replication

### Documentation & Writing
- **documentation**: Triggers: README, CHANGELOG, API docs, technical writing, user guides, code comments
- **writing-skills**: When creating new skills, editing existing skills, or verifying skills work before deployment
- **writing-style**: Triggers: blog posts, weekly updates, technical tutorials (Justin's personal blog writing style for Hugo site content)

See `~/.claude/skills/*/SKILL.md` for details.

---

## Session History Capture

Record significant session activities to `~/.claude/history/{project}.jsonl` for later analysis.

### When to Append

Append history at END of response for these events:

| Type | Trigger |
|------|---------|
| `task_complete` | Major task finished |
| `decision` | Design/architecture choice |
| `error_resolved` | Complex error fixed |
| `learning` | Discovered pattern/gotcha |
| `milestone` | Feature/phase completed |

**Skip**: Trivial file reads, routine git commands, simple questions.

### Entry Format

Append to `~/.claude/history/{project}.jsonl` (project = git repo name or directory):

```json
{"ts":"2026-01-15T23:30:00Z","sid":"abc12345","type":"task_complete","summary":"Implemented user auth","details":"Added JWT, bcrypt, endpoints","tags":["auth","api"]}
```

**Fields**: `ts` (UTC ISO8601), `sid` (session ID, first 8 chars), `type`, `summary` (max 100 chars), `details` (optional), `tags` (optional).

### Project Detection

1. Git repo name: `basename $(git rev-parse --show-toplevel)`
2. Directory name: `basename $PWD`
3. Fallback: `_global`

---
